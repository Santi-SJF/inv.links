<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tesis de Inversión Institucional: Nagarro SE</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js para gráficas -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        html { scroll-behavior: smooth; }
        .scroll-mt-24 { scroll-margin-top: 6rem; }
    </style>
</head>
<body class="bg-slate-50 font-sans text-slate-600">

    <!-- Mobile Overlay -->
    <div id="mobile-overlay" class="fixed inset-0 bg-black/50 z-40 hidden lg:hidden"></div>

    <!-- Sidebar Navigation -->
    <nav id="sidebar" class="fixed top-0 left-0 h-full bg-slate-900 text-white w-64 z-50 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out">
        <div class="p-6 border-b border-slate-700 flex justify-between items-center">
            <div>
                <h1 class="text-xl font-bold text-white tracking-tight">NA9.DE</h1>
                <p class="text-xs text-slate-400 mt-1">Tesis Institucional</p>
            </div>
            <button id="close-sidebar" class="lg:hidden text-slate-400 hover:text-white">
                <i data-lucide="x"></i>
            </button>
        </div>
        
        <div id="nav-links" class="py-4 overflow-y-auto h-[calc(100vh-80px)]">
            <!-- Nav links generated by JS -->
        </div>
    </nav>

    <!-- Main Content Wrapper -->
    <div class="lg:pl-64 transition-all duration-300">
        
        <!-- Header -->
        <header class="bg-white border-b border-slate-200 sticky top-0 z-30 px-6 py-4 flex justify-between items-center shadow-sm">
            <div class="flex items-center gap-4">
                <button id="open-sidebar" class="lg:hidden text-slate-500">
                    <i data-lucide="menu"></i>
                </button>
                <div>
                    <div id="header-date" class="text-xs font-bold text-blue-600 uppercase tracking-wider"></div>
                    <h2 id="header-title" class="text-lg font-bold text-slate-900 leading-tight hidden sm:block"></h2>
                    <h2 class="text-lg font-bold text-slate-900 leading-tight sm:hidden">Nagarro SE</h2>
                </div>
            </div>
            <div class="text-right">
                <div id="header-price" class="text-2xl font-bold text-slate-900"></div>
                <div id="header-target" class="text-xs font-bold text-green-600 bg-green-50 px-2 py-0.5 rounded inline-block"></div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="p-4 sm:p-8 max-w-6xl mx-auto space-y-8">

            <!-- KPI Grid -->
            <div id="kpi-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <!-- KPIs injected by JS -->
            </div>

            <!-- 1. Resumen Ejecutivo -->
            <section id="resumen" class="scroll-mt-24">
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                    <div class="flex items-center gap-3 mb-4 border-b border-slate-100 pb-3">
                        <div class="text-blue-600"><i data-lucide="target"></i></div>
                        <h3 class="text-xl font-bold text-slate-800">Resumen Ejecutivo</h3>
                    </div>
                    <p id="exec-summary-text" class="text-slate-700 leading-relaxed mb-6"></p>
                    <div id="exec-pillars" class="grid md:grid-cols-3 gap-6"></div>
                </div>
            </section>

            <!-- 2. Macro -->
            <section id="macro" class="scroll-mt-24">
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                    <div class="flex items-center gap-3 mb-4 border-b border-slate-100 pb-3">
                        <div class="text-blue-600"><i data-lucide="globe"></i></div>
                        <h3 class="text-xl font-bold text-slate-800">1. Análisis Macroeconómico</h3>
                    </div>
                    <div id="macro-grid" class="grid md:grid-cols-2 gap-6"></div>
                </div>
            </section>

            <!-- 3. Modelo de Negocio -->
            <section id="negocio" class="scroll-mt-24">
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                    <div class="flex items-center gap-3 mb-4 border-b border-slate-100 pb-3">
                        <div class="text-blue-600"><i data-lucide="briefcase"></i></div>
                        <h3 class="text-xl font-bold text-slate-800">2. Modelo de Negocio</h3>
                    </div>
                    
                    <div class="mb-6">
                        <h4 class="font-bold text-slate-800 mb-2 flex items-center gap-2">
                            <i data-lucide="activity" class="text-blue-500 w-4 h-4"></i>
                            La "Empresa Fluida"
                        </h4>
                        <p id="fluidic-text" class="text-sm text-slate-600 bg-slate-50 p-4 rounded border border-slate-100"></p>
                    </div>

                    <div class="grid md:grid-cols-2 gap-8">
                        <div>
                            <h4 class="font-bold text-slate-800 mb-4">Mix Geográfico</h4>
                            <div id="geo-mix" class="space-y-4"></div>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-bold text-slate-800 mb-2">Verticales Clave</h4>
                                <ul class="list-disc list-inside text-sm text-slate-600 space-y-2">
                                    <li><span class="font-semibold text-slate-700">Automoción (~26%):</span> Altos costes de cambio, software embebido.</li>
                                    <li><span class="font-semibold text-slate-700">Sector Público (~10%):</span> Contratos pegajosos y contracíclicos.</li>
                                    <li><span class="font-semibold text-slate-700">Retail/CPG:</span> Cíclico, rebotando con confianza consumidor.</li>
                                </ul>
                            </div>
                            <div class="bg-blue-50 p-3 rounded border border-blue-100">
                                <span class="font-bold text-blue-800 text-sm">Glass Window Strategy:</span>
                                <p id="glass-window" class="text-xs text-blue-700 mt-1"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 4. Financiero -->
            <section id="financiero" class="scroll-mt-24">
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                    <div class="flex items-center gap-3 mb-4 border-b border-slate-100 pb-3">
                        <div class="text-blue-600"><i data-lucide="bar-chart-2"></i></div>
                        <h3 class="text-xl font-bold text-slate-800">3. Análisis Financiero (Evolución 2020-2025E)</h3>
                    </div>

                    <!-- Chart Container -->
                    <div class="h-80 w-full mb-8 relative">
                        <canvas id="financialChart"></canvas>
                    </div>

                    <!-- Financial Table -->
                    <div class="overflow-x-auto border rounded-lg mb-6">
                        <table class="w-full text-sm text-left">
                            <thead class="bg-slate-100 text-slate-700 font-bold uppercase text-xs">
                                <tr>
                                    <th class="px-4 py-3">Métrica</th>
                                    <th class="px-4 py-3 text-right">2020</th>
                                    <th class="px-4 py-3 text-right">2021</th>
                                    <th class="px-4 py-3 text-right">2022</th>
                                    <th class="px-4 py-3 text-right">2023</th>
                                    <th class="px-4 py-3 text-right">2024</th>
                                    <th class="px-4 py-3 text-right bg-blue-50 text-blue-700">2025 (Est)</th>
                                </tr>
                            </thead>
                            <tbody id="financial-table-body" class="divide-y divide-slate-100">
                                <!-- Table rows injected by JS -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Balance Sheet Info -->
                    <div class="grid md:grid-cols-2 gap-4 text-sm">
                        <div class="bg-slate-50 p-4 rounded border border-slate-100">
                            <h5 class="font-bold text-slate-800 mb-2">Balance y Deuda</h5>
                            <ul id="balance-list" class="space-y-1"></ul>
                        </div>
                        <div class="bg-slate-50 p-4 rounded border border-slate-100">
                            <h5 class="font-bold text-slate-800 mb-2">Controversia Factoring</h5>
                            <p id="factoring-text" class="text-xs text-slate-600 leading-relaxed"></p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Grid for Governance and Peers -->
            <div class="grid lg:grid-cols-2 gap-6">
                <!-- 5. Gobernanza -->
                <section id="gobernanza" class="scroll-mt-24">
                    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 h-full">
                        <div class="flex items-center gap-3 mb-4 border-b border-slate-100 pb-3">
                            <div class="text-blue-600"><i data-lucide="shield-check"></i></div>
                            <h3 class="text-xl font-bold text-slate-800">4. Directiva y Gobernanza</h3>
                        </div>
                        <ul id="governance-list" class="space-y-4"></ul>
                    </div>
                </section>

                <!-- 6. Pares -->
                <section id="pares" class="scroll-mt-24">
                    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 h-full">
                        <div class="flex items-center gap-3 mb-4 border-b border-slate-100 pb-3">
                            <div class="text-blue-600"><i data-lucide="users"></i></div>
                            <h3 class="text-xl font-bold text-slate-800">5. Comparables (2026 Est.)</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead class="bg-slate-100 text-slate-600 text-xs uppercase">
                                    <tr>
                                        <th class="px-2 py-2 text-left">Empresa</th>
                                        <th class="px-2 py-2 text-center">EV/EBITDA</th>
                                        <th class="px-2 py-2 text-center">P/E</th>
                                    </tr>
                                </thead>
                                <tbody id="peers-table-body" class="divide-y"></tbody>
                            </table>
                            <p class="text-xs text-slate-500 mt-3 italic">
                                *El desajuste de valoración (7x vs 14x-16x) sugiere un potencial alcista del 40-50% solo por revalorización parcial.
                            </p>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Grid for Technical and Catalysts -->
            <div class="grid lg:grid-cols-2 gap-6">
                <!-- 7. Técnico -->
                <section id="tecnico" class="scroll-mt-24">
                    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 h-full">
                        <div class="flex items-center gap-3 mb-4 border-b border-slate-100 pb-3">
                            <div class="text-blue-600"><i data-lucide="activity"></i></div>
                            <h3 class="text-xl font-bold text-slate-800">6. Momentum y Técnico</h3>
                        </div>
                        <div class="space-y-4">
                            <div class="bg-slate-50 p-3 rounded">
                                <div class="text-sm font-bold text-slate-700">Estado Actual</div>
                                <div id="tech-status" class="text-slate-600"></div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <div class="text-xs text-slate-400">Medias Móviles</div>
                                    <div id="tech-ma" class="text-sm font-medium text-slate-800"></div>
                                </div>
                                <div>
                                    <div class="text-xs text-slate-400">RSI (14)</div>
                                    <div id="tech-rsi" class="text-sm font-medium text-slate-800"></div>
                                </div>
                            </div>
                            <div class="bg-green-50 p-3 rounded border border-green-100 mt-2">
                                <span class="text-green-800 font-bold text-sm">Estrategia:</span>
                                <span class="text-green-700 text-sm ml-2">Tendencia alcista a LP intacta si mantiene soporte €67.</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 8. Catalizadores -->
                <section id="catalizadores" class="scroll-mt-24">
                    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 h-full">
                        <div class="flex items-center gap-3 mb-4 border-b border-slate-100 pb-3">
                            <div class="text-blue-600"><i data-lucide="trending-up"></i></div>
                            <h3 class="text-xl font-bold text-slate-800">7. Catalizadores 2026</h3>
                        </div>
                        <ul id="catalysts-list" class="space-y-3"></ul>
                        <div class="mt-6 pt-4 border-t border-slate-100">
                            <h5 class="font-bold text-slate-800 text-sm mb-3 flex items-center gap-2">
                                <i data-lucide="calendar" class="w-4 h-4"></i> Calendario Próximo
                            </h5>
                            <div id="calendar-list" class="space-y-2"></div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- 9. Riesgos y Escenarios -->
            <section id="riesgos" class="scroll-mt-24">
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                    <div class="flex items-center gap-3 mb-4 border-b border-slate-100 pb-3">
                        <div class="text-blue-600"><i data-lucide="alert-triangle"></i></div>
                        <h3 class="text-xl font-bold text-slate-800">9. Riesgos y 10. Escenarios</h3>
                    </div>
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div>
                            <h4 class="font-bold text-slate-800 mb-4">Riesgos Principales</h4>
                            <ul id="risks-list" class="space-y-3 mb-6"></ul>
                        </div>
                        <div>
                            <h4 class="font-bold text-slate-800 mb-4">Escenarios de Retorno (FY2026)</h4>
                            <div id="scenarios-list" class="space-y-2"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 10. Conclusión -->
            <section id="conclusion" class="scroll-mt-24 mb-12">
                <div class="bg-slate-900 text-white rounded-xl shadow-lg p-6 md:p-8">
                    <div class="flex flex-col md:flex-row gap-8">
                        <div class="flex-1">
                            <h3 class="text-2xl font-bold mb-4 flex items-center gap-2">
                                <i data-lucide="target" class="text-green-400"></i> Veredicto Final
                            </h3>
                            <p class="text-slate-300 leading-relaxed mb-4">
                                Nagarro SE es una jugada clásica de "Deep Value". La compañía ha sobrevivido al estrés de 2023/2024 emergiendo más eficiente. 
                                Comprar a ~€70 implica adquirir una firma de alta calidad expuesta a la IA al precio de un proveedor heredado.
                            </p>
                            <div class="text-xl font-bold text-green-400">Compra Fuerte para capital paciente.</div>
                        </div>
                        
                        <div class="md:w-1/3 bg-slate-800 p-5 rounded-lg border border-slate-700">
                            <h4 class="text-red-400 font-bold mb-3 flex items-center gap-2">
                                <i data-lucide="alert-triangle" class="w-4 h-4"></i> Red Flags (Alertas)
                            </h4>
                            <ul id="red-flags-list" class="text-sm space-y-2 text-slate-300"></ul>
                        </div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <script>
        // --- DATOS DEL DOCUMENTO (COPIA EXACTA) ---
        const reportData = {
            header: {
                title: "Tesis de Inversión Institucional: Nagarro SE",
                date: "12 de enero de 2026",
                ticker: "NA9 (XETRA)",
                sector: "Tecnología / Servicios de TI / Ingeniería Digital",
                currentPrice: "€70.55",
                targetPrice: "€125.00",
                recommendation: "SOBREPONDERAR (COMPRAR)",
                upside: "+77.1%"
            },
            executiveSummary: {
                text: "A fecha de 12 de enero de 2026, Nagarro SE representa una de las oportunidades idiosincrásicas más atractivas dentro del universo de pequeña y mediana capitalización tecnológica en Europa. Tras un periodo de turbulencia (2023-2024), la compañía ha ejecutado un riguroso cambio de rumbo operativo. Los resultados del Q3 2025 confirman que la crisis de credibilidad está resuelta, pero el mercado sigue valorando el activo con un descuento significativo.",
                pillars: [
                    { title: "Alineación Macroeconómica", desc: "Recuperación alemana (PIB +1.2% en 2026) y demanda sostenida en EE. UU." },
                    { title: "Madurez Operativa", desc: "Transición a 'crecimiento rentable'. Optimización de pirámide de talento. Margen bruto >33%." },
                    { title: "Revalorización", desc: "Normalización de gobernanza y asignación de capital disciplinada (recompras) cerrarán la brecha de valoración." }
                ]
            },
            macro: [
                { area: "Alemania (Doméstico)", icon: "globe", desc: "Rebote cíclico en 2026 (PIB 1.2%-1.5%). Liberación de demanda reprimida en 'Industria 4.0' y sector automotriz. Beneficio por política fiscal expansiva." },
                { area: "Estados Unidos (Motor)", icon: "dollar-sign", desc: "'Aterrizaje suave' logrado. Gasto mundial en TI crecerá 9.8% en 2026. Firmas de ingeniería especializada ganan cuota frente a generalistas." },
                { area: "Superciclo IA", icon: "cpu", desc: "Transición de 'Hype' a 'Implementación'. IA es inflacionaria para el volumen y deflacionaria para el coste unitario. Nagarro entrega más código manteniendo valor de contratos." },
                { area: "Divisas (FX)", icon: "trending-up", desc: "Estructuralmente corta en Rupias (costes) y larga en USD/EUR (ingresos). La depreciación de la Rupia actúa como cobertura natural de margen." }
            ],
            businessModel: {
                structure: "Fluidic Enterprise: Estructura de 'colmena' descentralizada sin jerarquías rígidas. Cultura 'CARING'. Permite ajustes rápidos de costes sin grandes cargos por reestructuración.",
                segments: [
                    { name: "Norteamérica", value: 35, desc: "34-35%. Alto crecimiento/margen. Consumo Digital, Retail, Alta Tecnología." },
                    { name: "Europa Central", value: 30, desc: "29-30%. Estabilidad. Automoción, Manufactura, Sector Público." },
                    { name: "Resto del Mundo", value: 25, desc: "23-25%. Rápido crecimiento. Proyectos gubernamentales en el Golfo." }
                ],
                verticals: "Automoción (26%, altos costes de cambio), Sector Público (10%, contracíclico), Retail/CPG (cíclico en rebote).",
                glassWindow: "Estrategia de cuentas donde empleados jóvenes rotan en sombras de liderazgo para fomentar intimidad con el cliente."
            },
            financials: [
                { year: '2020', revenue: 430.4, ebitda: 76.2, margin: 17.7 },
                { year: '2021', revenue: 546.0, ebitda: 79.7, margin: 14.6 },
                { year: '2022', revenue: 856.3, ebitda: 148.5, margin: 17.3 },
                { year: '2023', revenue: 912.1, ebitda: 126.1, margin: 13.8 },
                { year: '2024', revenue: 972.0, ebitda: 147.5, margin: 15.2 },
                { year: '2025E', revenue: 1060.0, ebitda: 175.0, margin: 16.5 },
            ],
            balanceSheet: {
                netDebt: "€185.0M (Est. 2025)",
                leverage: "~1.1x (Net Debt/EBITDA)",
                covenants: "Límite 3.5x (Amplio margen)",
                factoring: "Reducción de dependencia en 2024/2025 demostrando generación robusta de caja operativa."
            },
            governance: {
                leadership: "Manas Fuloria (Cofundador/Arquitecto Fluidic Enterprise). Consejo de Finanzas fortalecido.",
                changes: "Cambio a auditor Tier-1 completado. Ampliación del Consejo de Supervisión con expertos independientes.",
                alignment: "Directiva posee >15-20% del capital. Recompra de acciones (€50M en 2025)."
            },
            peers: [
                { name: "Globant (GLOB)", growth: "15-18%", margin: "~21%", evEbitda: 17, pe: 30 },
                { name: "EPAM Systems", growth: "10-12%", margin: "~17%", evEbitda: 14.5, pe: 25 },
                { name: "Endava (DAVA)", growth: "8-10%", margin: "~16%", evEbitda: 10.5, pe: 18 },
                { name: "Nagarro (NA9)", growth: "9-11%", margin: "~16.5%", evEbitda: 7.5, pe: 13 },
            ],
            technical: {
                status: "Consolidación tras repunte. 'Buy the Dip' en €70.",
                movingAvg: "50D: ~€77 (Debilidad CP), 200D: ~€74 (Soporte clave).",
                rsi: "57 (Neutral).",
                macd: "Cruce bajista CP, confirmando consolidación."
            },
            catalysts: [
                "Mejora de Guías (Q1 2026): Ingresos >€1.1bn, Margen >16%.",
                "Ponderación en Índices SDAX/TecDAX: Aumento de flujo pasivo.",
                "Reanudación de M&A: Adquisiciones 'tuck-in' (IA/Boutique USA).",
                "Cierre de Cortos: Presión sobre posiciones cortas remanentes.",
                "Capital Markets Day 2026 (Q2): Plan 'Visión 2030'."
            ],
            calendar: [
                { date: "21 Ene 2026", event: "KPIs Preliminares FY2025" },
                { date: "Marzo 2026", event: "Informe Anual Auditado FY2025" },
                { date: "15 May 2026", event: "Declaración Trimestral Q1 2026" },
                { date: "Junio 2026", event: "Junta General (AGM)" }
            ],
            risks: [
                { title: "Tipo de Cambio", desc: "Apreciación de INR vs EUR/USD erosionaría márgenes." },
                { title: "Geopolítica", desc: "Proximidad Rumanía-Ucrania. Posibles aranceles EE. UU." },
                { title: "Talento", desc: "Inflación salarial en India y retención de talento senior." },
                { title: "Clientes", desc: "Pérdida de cliente clave Automoción (Top 5 <15% total)." }
            ],
            scenarios: [
                { name: "Bajista", prob: "15%", price: "€52.00", upside: "-26%", desc: "Recesión H2 2026. Márgenes al 13%. Gobernanza preocupa." },
                { name: "Base", prob: "55%", price: "€117.00", upside: "+66%", desc: "Ingresos +9%. Margen 16%. Múltiplo 9x EV/EBITDA." },
                { name: "Alcista", prob: "30%", price: "€165.00", upside: "+134%", desc: "Superciclo IA. Márgenes 17.5%. 'Mini-EPAM'. 12x EV/EBITDA." }
            ],
            redFlags: [
                "Recurrencia crecimiento Factoring desproporcionado.",
                "Salidas repentinas de Dirección (CEO/CFO).",
                "Revisión de Guías a la baja en H1 2026.",
                "Deslizamiento de Márgenes EBITDA <14%.",
                "Venta de Insiders (Lantano) a precios bajos."
            ]
        };

        // --- RENDER LOGIC ---

        function renderHeader() {
            document.getElementById('header-date').textContent = reportData.header.date;
            document.getElementById('header-title').textContent = reportData.header.title;
            document.getElementById('header-price').textContent = reportData.header.currentPrice;
            document.getElementById('header-target').textContent = 'Obj: ' + reportData.header.targetPrice;
        }

        function renderKPIs() {
            const container = document.getElementById('kpi-grid');
            const kpis = [
                { label: "Recomendación", value: "COMPRAR", subtext: "Sobreponderar", highlight: true },
                { label: "Precio Objetivo", value: reportData.header.targetPrice, subtext: "12-18 Meses" },
                { label: "Potencial", value: reportData.header.upside, subtext: "Revalorización Implicada", highlight: true },
                { label: "Ticker", value: "NA9", subtext: "XETRA (Alemania)" }
            ];

            container.innerHTML = kpis.map(kpi => `
                <div class="p-4 rounded-lg border ${kpi.highlight ? 'bg-blue-50 border-blue-200' : 'bg-slate-50 border-slate-200'}">
                    <div class="text-sm text-slate-500 font-medium mb-1">${kpi.label}</div>
                    <div class="text-2xl font-bold ${kpi.highlight ? 'text-blue-700' : 'text-slate-800'}">${kpi.value}</div>
                    ${kpi.subtext ? `<div class="text-xs text-slate-400 mt-1">${kpi.subtext}</div>` : ''}
                </div>
            `).join('');
        }

        function renderExecutiveSummary() {
            document.getElementById('exec-summary-text').textContent = reportData.executiveSummary.text;
            const pillarsContainer = document.getElementById('exec-pillars');
            pillarsContainer.innerHTML = reportData.executiveSummary.pillars.map(pillar => `
                <div class="bg-slate-50 p-4 rounded-lg border border-slate-100">
                    <div class="font-bold text-blue-700 mb-2">${pillar.title}</div>
                    <p class="text-sm text-slate-600">${pillar.desc}</p>
                </div>
            `).join('');
        }

        function renderMacro() {
            const container = document.getElementById('macro-grid');
            container.innerHTML = reportData.macro.map(item => `
                <div class="flex gap-4 p-4 rounded-lg border border-slate-100 hover:border-blue-100 transition-colors">
                    <div class="text-blue-500 shrink-0 bg-blue-50 p-3 rounded-full h-fit">
                        <i data-lucide="${item.icon}"></i>
                    </div>
                    <div>
                        <h4 class="font-bold text-slate-800 mb-1">${item.area}</h4>
                        <p class="text-sm text-slate-600 leading-relaxed">${item.desc}</p>
                    </div>
                </div>
            `).join('');
        }

        function renderBusinessModel() {
            document.getElementById('fluidic-text').textContent = reportData.businessModel.structure;
            document.getElementById('glass-window').textContent = reportData.businessModel.glassWindow;
            
            const mixContainer = document.getElementById('geo-mix');
            mixContainer.innerHTML = reportData.businessModel.segments.map(seg => `
                <div>
                    <div class="flex justify-between text-sm mb-1">
                        <span class="font-medium text-slate-700">${seg.name}</span>
                        <span class="font-bold text-slate-900">${seg.value}%</span>
                    </div>
                    <div class="w-full bg-slate-100 rounded-full h-2 mb-1">
                        <div class="bg-blue-600 h-2 rounded-full" style="width: ${seg.value}%"></div>
                    </div>
                    <p class="text-xs text-slate-500">${seg.desc}</p>
                </div>
            `).join('');
        }

        function renderFinancialTable() {
            const tbody = document.getElementById('financial-table-body');
            
            const rows = [
                { label: 'Ingresos (€ Millones)', key: 'revenue', format: v => v.toFixed(1) },
                { label: 'Margen Bruto', manual: ['31.9%', '28.5%', '28.9%', '26.3%', '30.4%', '~33.0%'] },
                { label: 'EBITDA Ajustado (€M)', key: 'ebitda', format: v => v.toFixed(1) },
                { label: 'Margen EBITDA Adj.', key: 'margin', format: v => v.toFixed(1) + '%' },
                { label: 'Apalancamiento Neto', manual: ['2.1x', '2.0x', '1.5x', '1.7x', '1.3x', '~1.1x'], italic: true }
            ];

            tbody.innerHTML = rows.map(row => {
                let cells = '';
                if (row.manual) {
                    cells = row.manual.map((val, idx) => `
                        <td class="px-4 py-2 text-right ${idx === 5 ? 'font-bold bg-blue-50 text-blue-700' : ''}">${val}</td>
                    `).join('');
                } else {
                    cells = reportData.financials.map((yearData, idx) => {
                        let val = row.format ? row.format(yearData[row.key]) : yearData[row.key];
                        // Special fix for 2025E formatting in specific rows if needed
                        if(idx === 5 && row.key === 'ebitda') val = '~' + val;
                        if(idx === 5 && row.key === 'margin') val = '~' + val;
                        return `<td class="px-4 py-2 text-right ${idx === 5 ? 'font-bold bg-blue-50 text-blue-700' : ''}">${val}</td>`;
                    }).join('');
                }
                
                return `
                    <tr class="hover:bg-slate-50 ${row.italic ? 'text-slate-500 italic' : ''}">
                        <td class="px-4 py-2 font-medium">${row.label}</td>
                        ${cells}
                    </tr>
                `;
            }).join('');
            
            // Balance Sheet
            document.getElementById('balance-list').innerHTML = `
                <li class="flex justify-between"><span>Deuda Neta:</span> <span class="font-mono font-bold">${reportData.balanceSheet.netDebt}</span></li>
                <li class="flex justify-between"><span>Apalancamiento:</span> <span class="font-mono font-bold">${reportData.balanceSheet.leverage}</span></li>
                <li class="flex justify-between text-green-600"><span>Covenants:</span> <span>${reportData.balanceSheet.covenants}</span></li>
            `;
            document.getElementById('factoring-text').textContent = reportData.balanceSheet.factoring;
        }

        function renderGovernance() {
            const list = document.getElementById('governance-list');
            list.innerHTML = `
                <li class="flex gap-3">
                    <div class="text-slate-400 shrink-0 mt-1"><i data-lucide="users" class="w-4 h-4"></i></div>
                    <div>
                        <strong class="text-slate-800 block">Liderazgo</strong>
                        <span class="text-sm text-slate-600">${reportData.governance.leadership}</span>
                    </div>
                </li>
                <li class="flex gap-3">
                    <div class="text-slate-400 shrink-0 mt-1"><i data-lucide="file-text" class="w-4 h-4"></i></div>
                    <div>
                        <strong class="text-slate-800 block">Evolución</strong>
                        <span class="text-sm text-slate-600">${reportData.governance.changes}</span>
                    </div>
                </li>
                <li class="flex gap-3">
                    <div class="text-slate-400 shrink-0 mt-1"><i data-lucide="target" class="w-4 h-4"></i></div>
                    <div>
                        <strong class="text-slate-800 block">Skin in the Game</strong>
                        <span class="text-sm text-slate-600">${reportData.governance.alignment}</span>
                    </div>
                </li>
            `;
        }

        function renderPeers() {
            const tbody = document.getElementById('peers-table-body');
            tbody.innerHTML = reportData.peers.map(peer => `
                <tr class="${peer.name.includes("Nagarro") ? "bg-blue-50 font-bold" : ""}">
                    <td class="px-2 py-3">
                        <div class="text-slate-900">${peer.name}</div>
                        <div class="text-xs text-slate-500">Mg: ${peer.margin}</div>
                    </td>
                    <td class="px-2 py-3 text-center font-mono">
                        ${typeof peer.evEbitda === 'number' ? '~' + peer.evEbitda + 'x' : peer.evEbitda}
                    </td>
                    <td class="px-2 py-3 text-center font-mono">
                        ${typeof peer.pe === 'number' ? '~' + peer.pe + 'x' : peer.pe}
                    </td>
                </tr>
            `).join('');
        }

        function renderTechnicalAndCatalysts() {
            // Technical
            document.getElementById('tech-status').textContent = reportData.technical.status;
            document.getElementById('tech-ma').textContent = reportData.technical.movingAvg;
            document.getElementById('tech-rsi').textContent = reportData.technical.rsi;
            
            // Catalysts
            document.getElementById('catalysts-list').innerHTML = reportData.catalysts.map(cat => `
                <li class="flex gap-2 items-start text-sm">
                    <span class="text-green-500 shrink-0 mt-0.5"><i data-lucide="arrow-up-right" class="w-4 h-4"></i></span>
                    <span class="text-slate-700">${cat}</span>
                </li>
            `).join('');
            
            document.getElementById('calendar-list').innerHTML = reportData.calendar.map(evt => `
                <div class="flex justify-between text-xs">
                    <span class="font-mono text-slate-500">${evt.date}</span>
                    <span class="font-medium text-slate-800">${evt.event}</span>
                </div>
            `).join('');
        }

        function renderRisksAndScenarios() {
            // Risks
            document.getElementById('risks-list').innerHTML = reportData.risks.map(risk => `
                <li class="bg-red-50 p-3 rounded border border-red-100">
                    <strong class="text-red-800 block text-sm">${risk.title}</strong>
                    <span class="text-red-700 text-xs">${risk.desc}</span>
                </li>
            `).join('');

            // Scenarios
            document.getElementById('scenarios-list').innerHTML = reportData.scenarios.map(scen => {
                let colorClass = "bg-slate-400";
                let textColor = "text-green-600";
                if(scen.prob.includes("15")) { colorClass = "bg-red-500"; textColor = "text-red-600"; }
                if(scen.prob.includes("55")) { colorClass = "bg-blue-600"; }
                if(scen.prob.includes("30")) { colorClass = "bg-green-500"; }

                const width = scen.prob.replace('%', '') + '%';
                
                return `
                <div class="relative mb-6 last:mb-0">
                    <div class="flex justify-between items-end mb-2">
                        <div>
                            <span class="text-sm font-bold text-slate-700 uppercase tracking-wide">${scen.name}</span>
                            <span class="ml-2 text-xs bg-slate-100 text-slate-600 px-2 py-0.5 rounded-full border border-slate-200">Prob: ${scen.prob}</span>
                        </div>
                        <div class="text-right">
                            <div class="text-lg font-bold text-slate-900">${scen.price}</div>
                            <div class="text-xs font-bold ${textColor}">
                                ${scen.upside}
                            </div>
                        </div>
                    </div>
                    <div class="text-sm text-slate-600 mb-2">${scen.desc}</div>
                    <div class="w-full h-2 bg-slate-100 rounded-full overflow-hidden">
                        <div class="h-full ${colorClass}" style="width: ${width}"></div>
                    </div>
                </div>
                `;
            }).join('');
        }

        function renderRedFlags() {
             document.getElementById('red-flags-list').innerHTML = reportData.redFlags.map(flag => `
                <li class="flex gap-2">
                    <span class="text-red-500">•</span>
                    ${flag}
                </li>
             `).join('');
        }

        function initChart() {
            const ctx = document.getElementById('financialChart').getContext('2d');
            const years = reportData.financials.map(d => d.year);
            const revenues = reportData.financials.map(d => d.revenue);
            const margins = reportData.financials.map(d => d.margin);

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: years,
                    datasets: [
                        {
                            label: 'Ingresos (€M)',
                            data: revenues,
                            backgroundColor: '#3b82f6',
                            yAxisID: 'y',
                            order: 2,
                            borderRadius: 4
                        },
                        {
                            label: 'Margen EBITDA (%)',
                            data: margins,
                            borderColor: '#ef4444',
                            backgroundColor: '#ef4444',
                            type: 'line',
                            yAxisID: 'y1',
                            order: 1,
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: { position: 'top' },
                        tooltip: {
                            backgroundColor: '#fff',
                            titleColor: '#1e293b',
                            bodyColor: '#475569',
                            borderColor: '#e2e8f0',
                            borderWidth: 1,
                            padding: 10
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            grid: { display: false }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: { drawOnChartArea: false },
                            ticks: { callback: (v) => v + '%' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        function initNavigation() {
            const sections = [
                { id: 'resumen', label: 'Resumen Ejecutivo' },
                { id: 'macro', label: 'Análisis Macroeconómico' },
                { id: 'negocio', label: 'Modelo de Negocio' },
                { id: 'financiero', label: 'Análisis Financiero' },
                { id: 'gobernanza', label: 'Directiva y Gobernanza' },
                { id: 'pares', label: 'Comparables' },
                { id: 'tecnico', label: 'Momentum y Técnico' },
                { id: 'riesgos', label: 'Riesgos y Escenarios' },
                { id: 'conclusion', label: 'Conclusión y Alertas' },
            ];

            const navContainer = document.getElementById('nav-links');
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-overlay');
            const openBtn = document.getElementById('open-sidebar');
            const closeBtn = document.getElementById('close-sidebar');

            // Render Links
            navContainer.innerHTML = sections.map((sec, idx) => `
                <button
                    onclick="scrollToSection('${sec.id}')"
                    class="w-full text-left px-6 py-3 text-sm font-medium transition-colors flex items-center justify-between text-slate-300 hover:bg-slate-800 hover:text-white border-l-4 border-transparent nav-btn"
                    id="nav-btn-${sec.id}"
                >
                    ${sec.label}
                    <i data-lucide="chevron-right" class="w-4 h-4 hidden active-icon"></i>
                </button>
            `).join('');

            // Interaction
            function toggleMenu(show) {
                if(show) {
                    sidebar.classList.remove('-translate-x-full');
                    overlay.classList.remove('hidden');
                } else {
                    sidebar.classList.add('-translate-x-full');
                    overlay.classList.add('hidden');
                }
            }

            openBtn.addEventListener('click', () => toggleMenu(true));
            closeBtn.addEventListener('click', () => toggleMenu(false));
            overlay.addEventListener('click', () => toggleMenu(false));

            window.scrollToSection = (id) => {
                const el = document.getElementById(id);
                if(el) {
                    el.scrollIntoView({ behavior: 'smooth' });
                    // Highlight logic could be added here
                    toggleMenu(false);
                }
            };
        }

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            renderHeader();
            renderKPIs();
            renderExecutiveSummary();
            renderMacro();
            renderBusinessModel();
            renderFinancialTable();
            renderGovernance();
            renderPeers();
            renderTechnicalAndCatalysts();
            renderRisksAndScenarios();
            renderRedFlags();
            
            initNavigation();
            initChart();
            
            lucide.createIcons();
        });

    </script>
</body>
</html>