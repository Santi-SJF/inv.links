<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tesis de Inversión Institucional: Nagarro SE</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Animaciones suaves para el cambio de pestañas */
        .tab-content {
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        .tab-content.active {
            display: block;
            opacity: 1;
            animation: fadeIn 0.4s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Scrollbar personalizada */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
    </style>
</head>
<body class="bg-slate-900 text-slate-200 font-sans h-screen flex overflow-hidden">

    <!-- 1. SIDEBAR NAVIGATION (TABS) -->
    <aside class="w-72 bg-slate-950 border-r border-slate-800 flex flex-col shrink-0 z-20 transition-all duration-300 absolute lg:relative h-full -translate-x-full lg:translate-x-0" id="sidebar">
        <!-- Logo Area -->
        <div class="p-6 border-b border-slate-800 bg-slate-950/50 backdrop-blur">
            <h1 class="text-2xl font-bold text-white tracking-tight flex items-center gap-2">
                <i data-lucide="bar-chart-2" class="text-blue-500"></i> NA9.DE
            </h1>
            <p class="text-xs text-slate-400 mt-1 uppercase tracking-wider">Tesis Institucional</p>
        </div>
        
        <!-- Navigation Items -->
        <nav class="flex-1 overflow-y-auto py-4 px-3 space-y-1" id="nav-container">
            <!-- Buttons injected via JS -->
        </nav>

        <!-- Sidebar Footer -->
        <div class="p-4 border-t border-slate-800 text-xs text-slate-500">
            Informe Confidencial<br>Uso Interno
        </div>
    </aside>

    <!-- Overlay for mobile -->
    <div id="overlay" class="fixed inset-0 bg-black/50 z-10 hidden lg:hidden backdrop-blur-sm"></div>

    <!-- 2. MAIN CONTENT AREA -->
    <div class="flex-1 flex flex-col h-full relative w-full">
        
        <!-- TOP HEADER -->
        <header class="h-20 bg-slate-900/80 backdrop-blur border-b border-slate-800 flex justify-between items-center px-6 shrink-0 z-10">
            <div class="flex items-center gap-4">
                <button id="menu-btn" class="lg:hidden text-slate-400 hover:text-white">
                    <i data-lucide="menu"></i>
                </button>
                <div>
                    <h2 class="text-lg font-bold text-white leading-none">Nagarro SE</h2>
                    <span class="text-xs text-blue-400 font-mono mt-1 block">ISIN: DE000A3H2200</span>
                </div>
            </div>

            <div class="flex items-center gap-6 text-right">
                <!-- FECHA SOLICITADA -->
                <div class="hidden md:block">
                    <div class="text-xs text-slate-500 uppercase font-bold tracking-widest mb-0.5">Fecha del Informe</div>
                    <div class="text-sm font-medium text-slate-200 flex items-center gap-2 justify-end">
                        <i data-lucide="calendar" class="w-3 h-3"></i> 
                        <span id="header-date"></span>
                    </div>
                </div>

                <div class="bg-slate-800 px-4 py-2 rounded-lg border border-slate-700">
                    <div class="text-xs text-slate-400 uppercase">Precio Actual</div>
                    <div class="text-xl font-bold text-white" id="header-price"></div>
                </div>
            </div>
        </header>

        <!-- CONTENT SCROLL AREA -->
        <main class="flex-1 overflow-y-auto p-4 md:p-8 relative bg-gradient-to-br from-slate-900 to-slate-800">
            
            <div class="max-w-5xl mx-auto">
                
                <!-- TAB 1: RESUMEN EJECUTIVO -->
                <div id="tab-resumen" class="tab-content active">
                    <!-- KPI Cards -->
                    <div id="kpi-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8"></div>
                    
                    <div class="bg-white text-slate-700 rounded-xl shadow-xl border border-slate-200/60 p-6 md:p-8">
                        <h3 class="text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2 border-b pb-4">
                            <i data-lucide="target" class="text-blue-600"></i> Resumen Ejecutivo
                        </h3>
                        <p id="exec-text" class="text-lg leading-relaxed mb-8 text-slate-600"></p>
                        
                        <h4 class="font-bold text-slate-900 mb-4">Pilares de Inversión</h4>
                        <div id="exec-pillars" class="grid md:grid-cols-3 gap-6"></div>
                    </div>
                </div>

                <!-- TAB 2: MACRO -->
                <div id="tab-macro" class="tab-content">
                    <div class="bg-white text-slate-700 rounded-xl shadow-xl p-6 md:p-8">
                        <h3 class="text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2 border-b pb-4">
                            <i data-lucide="globe" class="text-blue-600"></i> Análisis Macroeconómico
                        </h3>
                        <div id="macro-grid" class="grid md:grid-cols-2 gap-6"></div>
                    </div>
                </div>

                <!-- TAB 3: NEGOCIO -->
                <div id="tab-negocio" class="tab-content">
                    <div class="bg-white text-slate-700 rounded-xl shadow-xl p-6 md:p-8 mb-6">
                        <h3 class="text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2 border-b pb-4">
                            <i data-lucide="briefcase" class="text-blue-600"></i> Modelo de Negocio
                        </h3>
                        
                        <div class="bg-slate-50 p-5 rounded-lg border border-slate-200 mb-8">
                            <h4 class="font-bold text-blue-800 mb-2 flex items-center gap-2">
                                <i data-lucide="activity" class="w-4 h-4"></i> Fluidic Enterprise
                            </h4>
                            <p id="business-struct" class="text-sm text-slate-600"></p>
                        </div>

                        <div class="grid md:grid-cols-2 gap-10">
                            <div>
                                <h4 class="font-bold text-slate-900 mb-4 text-lg">Mix Geográfico</h4>
                                <div id="geo-mix" class="space-y-5"></div>
                            </div>
                            <div class="space-y-6">
                                <div>
                                    <h4 class="font-bold text-slate-900 mb-2 text-lg">Verticales Clave</h4>
                                    <ul class="list-disc list-inside space-y-2 text-slate-600 marker:text-blue-500">
                                        <li><strong>Automoción (~26%):</strong> Altos costes de cambio.</li>
                                        <li><strong>Sector Público (~10%):</strong> Contratos pegajosos.</li>
                                        <li><strong>Retail/CPG:</strong> Rebote cíclico.</li>
                                    </ul>
                                </div>
                                <div class="bg-blue-50 border-l-4 border-blue-500 p-4">
                                    <div class="font-bold text-blue-900 text-sm mb-1">Estrategia "Glass Window"</div>
                                    <p id="glass-window" class="text-xs text-blue-700 leading-relaxed"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB 4: FINANCIERO -->
                <div id="tab-financiero" class="tab-content">
                    <div class="bg-white text-slate-700 rounded-xl shadow-xl p-6 md:p-8">
                        <h3 class="text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2 border-b pb-4">
                            <i data-lucide="bar-chart-2" class="text-blue-600"></i> Evolución Financiera
                        </h3>
                        
                        <!-- Chart Area -->
                        <div class="h-80 w-full mb-8 relative bg-slate-50 rounded-lg p-2 border border-slate-100">
                            <canvas id="finChart"></canvas>
                        </div>

                        <!-- Table -->
                        <div class="overflow-x-auto border rounded-lg mb-8">
                            <table class="w-full text-sm text-left">
                                <thead class="bg-slate-800 text-white font-bold uppercase text-xs">
                                    <tr>
                                        <th class="px-4 py-3">Métrica</th>
                                        <th class="px-4 py-3 text-right">2020</th>
                                        <th class="px-4 py-3 text-right">2021</th>
                                        <th class="px-4 py-3 text-right">2022</th>
                                        <th class="px-4 py-3 text-right">2023</th>
                                        <th class="px-4 py-3 text-right">2024</th>
                                        <th class="px-4 py-3 text-right bg-blue-600">2025E</th>
                                    </tr>
                                </thead>
                                <tbody id="fin-table-body" class="divide-y divide-slate-100"></tbody>
                            </table>
                        </div>

                        <!-- Balance Info -->
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="bg-slate-50 p-4 rounded border border-slate-200">
                                <h5 class="font-bold text-slate-800 mb-2">Solvencia</h5>
                                <ul id="balance-data" class="space-y-2 text-sm"></ul>
                            </div>
                            <div class="bg-slate-50 p-4 rounded border border-slate-200">
                                <h5 class="font-bold text-slate-800 mb-2">Factoring</h5>
                                <p id="factoring-data" class="text-xs text-slate-600"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB 5: GOBERNANZA -->
                <div id="tab-gobernanza" class="tab-content">
                    <div class="grid gap-6">
                        <div class="bg-white text-slate-700 rounded-xl shadow-xl p-6 md:p-8">
                            <h3 class="text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2 border-b pb-4">
                                <i data-lucide="shield-check" class="text-blue-600"></i> Gobernanza y Directiva
                            </h3>
                            <ul id="gov-list" class="space-y-6"></ul>
                        </div>
                    </div>
                </div>

                <!-- TAB 6: PARES (COMPARABLES) -->
                <div id="tab-pares" class="tab-content">
                    <div class="bg-white text-slate-700 rounded-xl shadow-xl p-6 md:p-8">
                        <h3 class="text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2 border-b pb-4">
                            <i data-lucide="users" class="text-blue-600"></i> Comparables (Est. 2026)
                        </h3>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead class="bg-slate-100 text-slate-600 text-xs uppercase font-bold">
                                    <tr>
                                        <th class="px-4 py-3 text-left">Empresa</th>
                                        <th class="px-4 py-3 text-center">Crecimiento</th>
                                        <th class="px-4 py-3 text-center">Margen</th>
                                        <th class="px-4 py-3 text-center bg-slate-200">EV/EBITDA</th>
                                        <th class="px-4 py-3 text-center">P/E</th>
                                    </tr>
                                </thead>
                                <tbody id="peers-table" class="divide-y divide-slate-100"></tbody>
                            </table>
                        </div>
                        <div class="mt-4 p-4 bg-green-50 border border-green-100 rounded-lg text-sm text-green-800">
                            <strong>Oportunidad:</strong> Nagarro cotiza a ~7.5x EV/EBITDA frente a ~15x de media de sus pares de alta calidad, implicando un descuento masivo injustificado.
                        </div>
                    </div>
                </div>

                 <!-- TAB 7: TÉCNICO -->
                 <div id="tab-tecnico" class="tab-content">
                    <div class="bg-white text-slate-700 rounded-xl shadow-xl p-6 md:p-8">
                        <h3 class="text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2 border-b pb-4">
                            <i data-lucide="activity" class="text-blue-600"></i> Momentum y Técnico
                        </h3>
                        
                        <div class="grid md:grid-cols-2 gap-8">
                            <div class="space-y-4">
                                <div class="p-4 bg-slate-50 rounded border border-slate-200">
                                    <div class="text-xs uppercase text-slate-400 font-bold mb-1">Estado</div>
                                    <div class="font-medium text-slate-800" id="tech-status"></div>
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="p-4 bg-slate-50 rounded border border-slate-200">
                                        <div class="text-xs uppercase text-slate-400 font-bold mb-1">RSI (14)</div>
                                        <div class="text-xl font-bold text-blue-600" id="tech-rsi"></div>
                                    </div>
                                    <div class="p-4 bg-slate-50 rounded border border-slate-200">
                                        <div class="text-xs uppercase text-slate-400 font-bold mb-1">Media 200D</div>
                                        <div class="text-xl font-bold text-slate-700">~€74</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-slate-800 text-slate-300 p-6 rounded-xl">
                                <h4 class="text-white font-bold mb-4 flex items-center gap-2">
                                    <i data-lucide="trending-up" class="text-green-400"></i> Catalizadores 2026
                                </h4>
                                <ul id="catalysts-list" class="space-y-3 text-sm"></ul>
                            </div>
                        </div>

                        <div class="mt-8 pt-6 border-t border-slate-100">
                             <h4 class="font-bold text-slate-800 mb-4">Calendario Financiero</h4>
                             <div id="calendar-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
                        </div>
                    </div>
                </div>

                <!-- TAB 8: RIESGOS Y ESCENARIOS -->
                <div id="tab-riesgos" class="tab-content">
                    <div class="bg-white text-slate-700 rounded-xl shadow-xl p-6 md:p-8">
                        <h3 class="text-2xl font-bold text-slate-800 mb-6 flex items-center gap-2 border-b pb-4">
                            <i data-lucide="alert-triangle" class="text-blue-600"></i> Riesgos y Escenarios
                        </h3>

                        <div class="grid lg:grid-cols-2 gap-8 mb-8">
                            <div>
                                <h4 class="font-bold text-slate-900 mb-4">Principales Riesgos</h4>
                                <div id="risk-list" class="space-y-3"></div>
                            </div>
                            <div>
                                <h4 class="font-bold text-slate-900 mb-4">Escenarios de Precio 2026</h4>
                                <div id="scenario-list" class="space-y-4"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB 9: CONCLUSIÓN -->
                <div id="tab-conclusion" class="tab-content">
                    <div class="bg-gradient-to-br from-slate-900 to-slate-800 text-white rounded-xl shadow-2xl p-8 md:p-12 border border-slate-700">
                        <div class="flex flex-col md:flex-row gap-10 items-start">
                            <div class="flex-1">
                                <div class="inline-block bg-green-500/20 text-green-300 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-widest mb-4 border border-green-500/50">Veredicto Final</div>
                                <h2 class="text-3xl md:text-4xl font-bold text-white mb-6">Compra Fuerte</h2>
                                <p class="text-slate-300 text-lg leading-relaxed mb-6">
                                    Nagarro SE es una jugada clásica de "Deep Value". El mercado ofrece actualmente la acción a ~€70, asumiendo erróneamente un estancamiento permanente. 
                                    Los datos fundamentales (margen 17.3%, crecimiento 9.4%) demuestran lo contrario.
                                </p>
                                <p class="text-slate-300 text-lg leading-relaxed">
                                    Estamos comprando ingeniería digital de alta calidad al precio de una consultora heredada. La relación riesgo/recompensa está fuertemente sesgada al alza.
                                </p>
                            </div>
                            
                            <div class="w-full md:w-80 bg-black/30 p-6 rounded-xl border border-red-900/50 backdrop-blur-sm">
                                <h4 class="text-red-400 font-bold mb-4 flex items-center gap-2 uppercase tracking-wide text-sm">
                                    <i data-lucide="siren" class="w-4 h-4"></i> Red Flags (Monitorizar)
                                </h4>
                                <ul id="red-flags" class="space-y-3 text-sm text-slate-300"></ul>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            
            <footer class="text-center text-slate-500 text-xs mt-12 mb-4">
                Fuente: Tesis de Inversión Institucional Nagarro SE • Generado el 12 de Enero de 2026
            </footer>
        </main>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- DATA (FROM DOCUMENT) ---
        const data = {
            header: { date: "12 Enero 2026", price: "€70.55", target: "€125.00", upside: "+77.1%" },
            kpis: [
                { label: "Recomendación", val: "COMPRAR", sub: "Sobreponderar", hl: true },
                { label: "Precio Objetivo", val: "€125.00", sub: "12-18 Meses", hl: false },
                { label: "Upside", val: "+77.1%", sub: "Potencial", hl: true },
                { label: "Ticker", val: "NA9", sub: "XETRA (DE)", hl: false },
            ],
            summary: {
                text: "Nagarro representa una oportunidad idiosincrásicas atractiva. Tras la turbulencia de 2023-24, ha ejecutado un cambio de rumbo operativo exitoso. Los resultados del Q3 2025 confirman la recuperación, pero el mercado mantiene un descuento significativo.",
                pillars: [
                    { title: "Macro Favor", desc: "Recuperación alemana (PIB +1.2%) y demanda fuerte en EE.UU." },
                    { title: "Madurez Operativa", desc: "Enfoque en rentabilidad. Margen bruto >33%. Optimización de talento." },
                    { title: "Revalorización", desc: "Mejora de gobernanza y recompras de acciones cerrarán el gap." }
                ]
            },
            macro: [
                { t: "Alemania (30%)", d: "Rebote cíclico 2026. Demanda 'Industria 4.0' reprimida se libera.", i: "map-pin" },
                { t: "EE.UU. (35%)", d: "Motor de margen. Gasto TI global +9.8%. Aterrizaje suave logrado.", i: "dollar-sign" },
                { t: "Superciclo IA", d: "Fase de implementación. IA infla volumen, no deflaciona ingresos.", i: "cpu" },
                { t: "Divisas (FX)", d: "Costes en INR, Ingresos en EUR/USD. Depreciación INR ayuda margen.", i: "trending-down" }
            ],
            business: {
                struct: "Estructura 'Fluidic Enterprise' sin jerarquías rígidas. Cultura CARING. Permite agilidad en costes.",
                geo: [
                    { n: "Norteamérica", v: 35, d: "Alto crecimiento" },
                    { n: "Europa Central", v: 30, d: "Estabilidad / Autos" },
                    { n: "Resto del Mundo", v: 25, d: "Gobierno / Golfo" }
                ],
                glass: "Estrategia donde empleados jóvenes rotan en sombras de liderazgo para fomentar intimidad con el cliente y evitar estancamiento."
            },
            fin: {
                rows: [
                    { m: "Ingresos (€M)", d: [430.4, 546.0, 856.3, 912.1, 972.0, "1,060"] },
                    { m: "EBITDA Adj (€M)", d: [76.2, 79.7, 148.5, 126.1, 147.5, "~175.0"] },
                    { m: "Margen %", d: [17.7, 14.6, 17.3, 13.8, 15.2, "16.5%"] },
                    { m: "Apalancamiento", d: ["2.1x", "2.0x", "1.5x", "1.7x", "1.3x", "1.1x"] }
                ],
                balance: ["Deuda Neta: €185M (Est 2025)", "Ratio: 1.1x EBITDA", "Covenant: <3.5x"],
                factoring: "Reducción de dependencia en 2024/25 demuestra flujo de caja real robusto."
            },
            gov: [
                { t: "Liderazgo", d: "Manas Fuloria (Fundador). Consejo de Finanzas fortalecido." },
                { t: "Cambios", d: "Auditor Tier-1 implementado. Consejo Supervisión ampliado." },
                { t: "Alineación", d: "Directiva posee >15%. Recompra de acciones (€50M) activa." }
            ],
            peers: [
                { n: "Globant", g: "15-18%", m: "21%", ev: "17x", pe: "30x" },
                { n: "EPAM", g: "10-12%", m: "17%", ev: "14.5x", pe: "25x" },
                { n: "Endava", g: "8-10%", m: "16%", ev: "10.5x", pe: "18x" },
                { n: "Nagarro", g: "9-11%", m: "16.5%", ev: "7.5x", pe: "13x", hl: true },
            ],
            tech: {
                status: "Consolidación tras repunte. Zona de compra en €70.",
                rsi: "57 (Neutral)",
                catalysts: [
                    "Guías Q1 2026 (>€1.1bn)",
                    "Entrada en índices SDAX/TecDAX",
                    "M&A (Adquisiciones pequeñas)",
                    "Capital Markets Day (Q2 2026)"
                ],
                calendar: [
                    { d: "21 Ene", e: "KPIs FY25" },
                    { d: "Marzo", e: "Informe Anual" },
                    { d: "15 May", e: "Q1 2026" },
                    { d: "Junio", e: "AGM" }
                ]
            },
            risks: [
                { t: "Divisa", d: "Apreciación INR vs EUR daña márgenes." },
                { t: "Geopolítica", d: "Centros en Rumanía cerca de Ucrania." },
                { t: "Talento", d: "Inflación salarial en India." }
            ],
            scenarios: [
                { n: "Bajista (15%)", p: "€52", u: "-26%", c: "bg-red-500", d: "Recesión H2 2026. Márgenes caen al 13%. Gobernanza vuelve a preocupar." },
                { n: "Base (55%)", p: "€117", u: "+66%", c: "bg-blue-600", d: "Ingresos +9%. Margen 16%. Múltiplo normalizado a 9x EV/EBITDA." },
                { n: "Alcista (30%)", p: "€165", u: "+134%", c: "bg-green-500", d: "Superciclo IA. Márgenes 17.5%. Percibida como 'Mini-EPAM'. 12x EV/EBITDA." }
            ],
            redflags: [
                "Recurrencia factoring desproporcionado",
                "Salida repentina de CEO/CFO",
                "Recorte de guías en H1 2026",
                "Venta de acciones por insiders"
            ]
        };

        // --- RENDER FUNCTIONS ---

        function renderAll() {
            // Header
            document.getElementById('header-date').textContent = data.header.date;
            document.getElementById('header-price').textContent = data.header.price;

            // KPIs
            document.getElementById('kpi-grid').innerHTML = data.kpis.map(k => `
                <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm ${k.hl ? 'ring-2 ring-blue-500/20' : ''}">
                    <div class="text-xs text-slate-500 uppercase font-bold tracking-wide">${k.label}</div>
                    <div class="text-2xl font-bold ${k.hl ? 'text-blue-600' : 'text-slate-800'}">${k.val}</div>
                    <div class="text-xs text-slate-400 mt-1">${k.sub}</div>
                </div>
            `).join('');

            // Resumen
            document.getElementById('exec-text').textContent = data.summary.text;
            document.getElementById('exec-pillars').innerHTML = data.summary.pillars.map(p => `
                <div class="bg-slate-50 p-4 rounded-lg border border-slate-100">
                    <div class="font-bold text-blue-700 mb-2 text-sm uppercase">${p.title}</div>
                    <p class="text-sm text-slate-600">${p.desc}</p>
                </div>
            `).join('');

            // Macro
            document.getElementById('macro-grid').innerHTML = data.macro.map(m => `
                <div class="flex gap-4 p-4 rounded-lg border border-slate-100 hover:bg-slate-50 transition-colors">
                    <div class="text-blue-500 bg-blue-50 p-3 rounded-full h-fit"><i data-lucide="${m.i}"></i></div>
                    <div>
                        <h4 class="font-bold text-slate-800">${m.t}</h4>
                        <p class="text-sm text-slate-600 mt-1">${m.d}</p>
                    </div>
                </div>
            `).join('');

            // Negocio
            document.getElementById('business-struct').textContent = data.business.struct;
            document.getElementById('glass-window').textContent = data.business.glass;
            document.getElementById('geo-mix').innerHTML = data.business.geo.map(g => `
                <div>
                    <div class="flex justify-between text-sm mb-1 font-medium text-slate-700">
                        <span>${g.n}</span>
                        <span>${g.v}%</span>
                    </div>
                    <div class="w-full bg-slate-100 rounded-full h-2.5 mb-1 overflow-hidden">
                        <div class="bg-blue-600 h-2.5 rounded-full" style="width: ${g.v}%"></div>
                    </div>
                    <div class="text-xs text-slate-400">${g.d}</div>
                </div>
            `).join('');

            // Financiero
            const finBody = document.getElementById('fin-table-body');
            data.fin.rows.forEach(row => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-slate-50 border-b border-slate-50";
                let html = `<td class="px-4 py-3 font-medium text-slate-700">${row.m}</td>`;
                row.d.forEach((val, i) => {
                    const isEst = i === 5;
                    html += `<td class="px-4 py-3 text-right ${isEst ? 'font-bold text-blue-700 bg-blue-50' : 'text-slate-600'}">${val}</td>`;
                });
                tr.innerHTML = html;
                finBody.appendChild(tr);
            });
            
            document.getElementById('balance-data').innerHTML = data.fin.balance.map(b => 
                `<li class="flex items-center gap-2"><i data-lucide="check-circle" class="w-3 h-3 text-green-500"></i>${b}</li>`
            ).join('');
            document.getElementById('factoring-data').textContent = data.fin.factoring;

            // Gobernanza
            document.getElementById('gov-list').innerHTML = data.gov.map(g => `
                <li class="flex gap-4 items-start">
                    <div class="bg-blue-100 p-2 rounded-lg text-blue-600 mt-1"><i data-lucide="check" class="w-4 h-4"></i></div>
                    <div>
                        <strong class="text-slate-900 block text-lg">${g.t}</strong>
                        <span class="text-slate-600">${g.d}</span>
                    </div>
                </li>
            `).join('');

            // Pares
            document.getElementById('peers-table').innerHTML = data.peers.map(p => `
                <tr class="${p.hl ? 'bg-blue-50 border-l-4 border-blue-500' : ''}">
                    <td class="px-4 py-3 font-medium text-slate-800">${p.n}</td>
                    <td class="px-4 py-3 text-center text-slate-600">${p.g}</td>
                    <td class="px-4 py-3 text-center text-slate-600">${p.m}</td>
                    <td class="px-4 py-3 text-center font-mono font-bold ${p.hl ? 'text-blue-700' : 'text-slate-700'}">${p.ev}</td>
                    <td class="px-4 py-3 text-center font-mono text-slate-500">${p.pe}</td>
                </tr>
            `).join('');

            // Técnico
            document.getElementById('tech-status').textContent = data.tech.status;
            document.getElementById('tech-rsi').textContent = data.tech.rsi;
            document.getElementById('catalysts-list').innerHTML = data.tech.catalysts.map(c => 
                `<li class="flex gap-2"><i data-lucide="zap" class="w-4 h-4 text-yellow-400"></i> ${c}</li>`
            ).join('');
            document.getElementById('calendar-grid').innerHTML = data.tech.calendar.map(e => `
                <div class="bg-slate-50 p-2 rounded border border-slate-200 text-center">
                    <div class="text-xs font-bold text-blue-600 uppercase">${e.d}</div>
                    <div class="text-xs text-slate-700 font-medium truncate">${e.e}</div>
                </div>
            `).join('');

            // Riesgos y Escenarios
            document.getElementById('risk-list').innerHTML = data.risks.map(r => `
                <div class="bg-red-50 p-3 rounded-lg border border-red-100">
                    <strong class="text-red-900 text-sm block">${r.t}</strong>
                    <span class="text-red-700 text-xs">${r.d}</span>
                </div>
            `).join('');

            document.getElementById('scenario-list').innerHTML = data.scenarios.map(s => `
                <div class="relative mb-6 last:mb-0">
                    <div class="flex justify-between items-end mb-2">
                        <span class="text-sm font-bold text-slate-700">${s.n}</span>
                        <div class="text-right">
                            <span class="text-lg font-bold text-slate-900">${s.p}</span>
                            <span class="text-xs font-bold ${s.u.includes('-')?'text-red-500':'text-green-500'} block">${s.u}</span>
                        </div>
                    </div>
                    <div class="h-2 w-full bg-slate-100 rounded-full overflow-hidden mb-2">
                        <div class="h-full ${s.c}" style="width: ${s.n.match(/\d+/)[0]}%"></div>
                    </div>
                    <p class="text-xs text-slate-500 leading-relaxed">${s.d}</p>
                </div>
            `).join('');

            // Red Flags
            document.getElementById('red-flags').innerHTML = data.redflags.map(f => 
                `<li class="flex gap-2"><span class="text-red-500 font-bold">•</span> ${f}</li>`
            ).join('');

            // Initialize Chart
            initChart();
        }

        function initChart() {
            const ctx = document.getElementById('finChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['2020', '2021', '2022', '2023', '2024', '2025E'],
                    datasets: [
                        {
                            label: 'Margen EBITDA (%)',
                            data: [17.7, 14.6, 17.3, 13.8, 15.2, 16.5],
                            type: 'line',
                            borderColor: '#2563eb',
                            borderWidth: 3,
                            yAxisID: 'y1',
                            tension: 0.3,
                            pointBackgroundColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 4
                        },
                        {
                            label: 'Ingresos (€M)',
                            data: [430.4, 546.0, 856.3, 912.1, 972.0, 1060.0],
                            backgroundColor: '#94a3b8',
                            hoverBackgroundColor: '#3b82f6',
                            borderRadius: 4,
                            yAxisID: 'y'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'top' } },
                    scales: {
                        y: { display: false },
                        y1: { display: false, min: 10, max: 20 },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        // --- TAB LOGIC ---
        const sections = [
            { id: 'resumen', icon: 'target', label: 'Resumen' },
            { id: 'macro', icon: 'globe', label: 'Macroeconomía' },
            { id: 'negocio', icon: 'briefcase', label: 'Modelo Negocio' },
            { id: 'financiero', icon: 'bar-chart-2', label: 'Finanzas' },
            { id: 'gobernanza', icon: 'shield-check', label: 'Gobernanza' },
            { id: 'pares', icon: 'users', label: 'Comparables' },
            { id: 'tecnico', icon: 'activity', label: 'Técnico' },
            { id: 'riesgos', icon: 'alert-triangle', label: 'Riesgos' },
            { id: 'conclusion', icon: 'check-circle-2', label: 'Conclusión' }
        ];

        function initTabs() {
            const nav = document.getElementById('nav-container');
            
            sections.forEach(sec => {
                const btn = document.createElement('button');
                btn.className = `w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 text-sm font-medium transition-all duration-200 mb-1 ${sec.id === 'resumen' ? 'bg-blue-600 text-white shadow-lg shadow-blue-900/50' : 'text-slate-400 hover:text-white hover:bg-slate-800'}`;
                btn.innerHTML = `<i data-lucide="${sec.icon}" class="w-5 h-5"></i> ${sec.label}`;
                btn.onclick = () => switchTab(sec.id, btn);
                nav.appendChild(btn);
            });
        }

        function switchTab(id, btnElement) {
            // Hide all contents
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            // Show target content
            document.getElementById(`tab-${id}`).classList.add('active');
            
            // Update sidebar buttons
            document.querySelectorAll('#nav-container button').forEach(b => {
                b.className = 'w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 text-sm font-medium transition-all duration-200 mb-1 text-slate-400 hover:text-white hover:bg-slate-800';
            });
            btnElement.className = 'w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 text-sm font-medium transition-all duration-200 mb-1 bg-blue-600 text-white shadow-lg shadow-blue-900/50';

            // Close mobile menu if open
            toggleMenu(false);

            // Scroll to top
            document.querySelector('main').scrollTop = 0;
            
            // Refresh icons for newly visible elements (rare edge case)
            lucide.createIcons();
        }

        // Mobile Menu Logic
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        const menuBtn = document.getElementById('menu-btn');

        function toggleMenu(show) {
            if(show) {
                sidebar.classList.remove('-translate-x-full');
                overlay.classList.remove('hidden');
            } else {
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
            }
        }

        menuBtn.onclick = () => toggleMenu(true);
        overlay.onclick = () => toggleMenu(false);

        // --- INIT ---
        window.onload = () => {
            renderAll();
            initTabs();
            lucide.createIcons();
        };

    </script>
</body>
</html>